import{ActionStack}from"./actionStack";import{ZIndexProvider}from"./zIndexProvider";import{eventEmitter}from"./events";const zIndexProvider=new ZIndexProvider(10),escStack=new ActionStack,defaultFullScreenOptions={iconClass:{class:"full-screen-icon",full:"full-screen-icon__full",unFull:"full-screen-icon__un-full"},closeOnEsc:!0,closeAllOnEsc:!1,hideIcon:!1,iconContainerClass:"full-screen-icon-container",createIcon(e,t){var s;const{iconContainerClass:n,targetEl:l}=t.options;let i;if(n){const e=l.getElementsByClassName(n);e&&e.length&&(i=document.createElement("i"),e[0].appendChild(i))}return i||(i=document.createElement("i"),e.push("margin-left: 5px;position: absolute;top: 10px;right: 10px;"),l.appendChild(i),(null===(s=l.style)||void 0===s?void 0:s.position)||(l.style.position="relative")),i}};export class FullScreen{constructor(e={}){var t;this._full=!1,this._oldStyle="",this._listeners=[];const s=e.targetEl;this._options=Object.assign({},this.defaultFullScreenOptions,e),null===(t=s.classList)||void 0===t||t.add("full-screen-container"),e.hideIcon||this._createIcon(),this._options.autoFullScreen&&this.fullScreen(),s.__fullScreen__=this,this.addDefaultListeners();let n=this.options.actionListeners;this.on(n)}addDefaultListeners(){this.on(eventEmitter)}_createIcon(){const{iconClass:e,createIcon:t}=this.options,s=["cursor: pointer"];let n=t(s,this);n.setAttribute("class",e.class+" "+e.full),n.setAttribute("style",s.join(";")),this._onClickIcon=()=>{this.fullScreen()},n.addEventListener("click",this._onClickIcon),this._iconEl=n}destory(){const{iconEl:e,targetEl:t}=this;e.removeEventListener("click",this._onClickIcon),e.remove(),escStack.hasNext()||document.removeEventListener("keydown",onKeydownEsc),delete t.__fullScreen__}fullScreen(){var e,t,s;const{targetEl:n,full:l,iconEl:i}=this,{iconClass:o,closeOnEsc:c=!0,closeAllOnEsc:r=!1}=this.options;if(l)n.setAttribute("style",this.oldStyle),null===(s=n.classList)||void 0===s||s.remove("full-screen-container__full"),this.listeners.forEach((e=>e.cancelFullScreen(this))),c&&!escStack.hasNext()&&document.removeEventListener("keydown",onKeydownEsc),escStack.hasNext()&&r&&onKeydownEsc({code:"Escape"}),null==i||i.classList.add(o.full),null==i||i.classList.remove(o.unFull);else{let s=this.options.zIndex;this.oldStyle=n.getAttribute("style");const l=["position: fixed","left: 0","right: 0","top: 0","bottom: 0","width:100%","height:100%"];s?"function"==typeof s&&(s=s()):s=(null===(e=null==n?void 0:n.style)||void 0===e?void 0:e.zIndex)||zIndexProvider.next(),l.push("z-index:"+s),n.setAttribute("style",l.join(";")),null===(t=n.classList)||void 0===t||t.add("full-screen-container__full"),null==i||i.classList.add(o.unFull),null==i||i.classList.remove(o.full),this.listeners.forEach((e=>e.fullScreen(this))),c&&(escStack.push(this),document.addEventListener("keydown",onKeydownEsc))}this.full=!l}on(e=[]){Array.isArray(e)||(e=[e]),e.forEach((e=>{this.listeners.push(e)}))}get defaultFullScreenOptions(){return defaultFullScreenOptions}get listeners(){return this._listeners}set listeners(e){this._listeners=e}get targetEl(){return this.options.targetEl}get iconEl(){return this._iconEl}set iconEl(e){this._iconEl=e}get full(){return this._full}set full(e){this._full=e}get oldStyle(){return this._oldStyle}set oldStyle(e){this._oldStyle=e}get options(){return this._options}set options(e){this._options=e}}const onKeydownEsc=function(e){if("Escape"===e.code){const e=escStack.pop();e&&e.fullScreen()}};